<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#000000">
<title>Moonlight v1.2</title>
<link href="styles.css" rel="stylesheet" type="text/css">
<link rel="shortcut icon" href="favicon.ico">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
</head>
<body>
<div class="header">
<h1>Moonlight Setup</h1><p>v1.2</p>
</div>
<div class="content">
<br>
<div class="slidecontainer">
<div class="subheader"><h2>Target color:</h2></div>
<br>
<div class="tooltip">
  <input type="range" min="0" max="8000" value="0" class="slider" id="redTarget"> 
  <p class="red-target">Red: <span id="redTargetView"></span></p>
    <input type="range" min="0" max="8000" value="100" class="slider" id="greenTarget"> 
  <p class="green-target">Green: <span id="greenTargetView"></span></p>
    <input type="range" min="0" max="8000" value="500" class="slider" id="blueTarget"> 
  <p class="blue-target">Blue: <span id="blueTargetView"></span></p>
      <input type="range" min="0" max="8000" value="0" class="slider" id="whiteTarget"> 
  <p class="white-target">White: <span id="whiteTargetView"></span></p>
  <span class="tooltiptext">Target color ratio values. This color is set, when controller detect a motion.</span></div>
</div>
<br>
<div class="slidecontainer">
<div class="subheader"><h2>Standby color:</h2></div>
<br>
<div class="tooltip">
  <input type="range" min="0" max="100" value="0" class="slider" id="redStandby"> 
  <p class="red-standby">Red: <span id="redStandbyView"></span></p>
    <input type="range" min="0" max="100" value="0" class="slider" id="greenStandby"> 
  <p class="green-standby">Green: <span id="greenStandbyView"></span></p>
    <input type="range" min="0" max="100" value="0" class="slider" id="blueStandby"> 
  <p class="blue-standby">Blue: <span id="blueStandbyView"></span></p>
      <input type="range" min="0" max="100" value="0" class="slider" id="whiteStandby"> 
  <p class="white-standby">White: <span id="whiteStandbyView"></span></p>
  <span class="tooltiptext">This setting determines how controller works in standby mode, between motion detections. Values can be set to zero if you don't wan't any light, or to low values to get slightly, barely visible light.  </span></div>
</div>
<br>
<div class="threshold">
<div class="subheader"><h2>Threshold:</h2></div>
<br>

<label for="measuredLevel">Measured level: </label><div class="tooltip"><p class="measuredLevel"><span id="lightLevel">XXX</span></p><span class="tooltiptext">Show current light level measured by photoresistor. Refresh page to make new measurement.</span></div><br>
<label for="threshold">Threshold level:</label>
<div class="tooltip">
<input id="threshold" type="number" min="1" max="600" value="5" class="inputNumber">
<span class="tooltiptext">Threshold determines sensitive for ambient light. Use low values to enable controller only while ambient light is insignificant or when is just dark. The range of values depends on used photoresistor.</span></div>
</div> 
<br>
<div class="timings">
<div class="subheader"><h2>Timing (in seconds):</h2></div>
<br>

<label for="duration">Duration:</label>
<div class="tooltip">
<input id="duration" type="number" min="1" max="600" value="5" class="inputNumber"><span class="tooltiptext">Light duration. Can't be shorter than any fade time.</span></div><br>
<label for="fadeIn">Fade in:</label>
<div class="tooltip">
<input id="fadeIn" type="number" min="1" max="15" value="5" class="inputNumber">
<span class="tooltiptext">Fade in duration. It doesn't increase total light duration.</span></div><br>
<label for="fadeOut">Fade out:</label>
<div class="tooltip">
<input id="fadeOut" type="number" min="1" max="15" value="5" class="inputNumber">
<span class="tooltiptext">Fade out duration. It doesn't increase total light duration.</span></div><br>   
</div>
<br>
<br>
<div class="preview">
<div class="subheader"><h2>Preview:</h2></div>
<br>

<label for="previewEnable">Enable:</label><div class="tooltip"><input type="checkbox" id="previewEnable" value="1">
<span class="tooltiptext">When enabled controller will shortly light up LEDs anytime you change color slider. Also visualizes fading times on change.</span></div><br>
<label for="previewTime">Duration:</label>
<div class="tooltip">
<input id="previewTime" type="number" min="1" max="600" value="5" class="inputNumber">
<span class="tooltiptext">Determines light on duration for color changes. Preview works any time you make changes in colors.</span></div><br>
</div> <br>

</div>

<script>

$.get("/sensor/ldr", function(data){
document.getElementById("lightLevel").innerHTML = data.measureLight;
});

setupColors = function() {

var	redTarget = Number(document.getElementById("redTarget").value);
var	greenTarget = Number(document.getElementById("greenTarget").value);
var	blueTarget = Number(document.getElementById("blueTarget").value);
var	whiteTarget = Number(document.getElementById("whiteTarget").value);
var	redStandby = Number(document.getElementById("redStandby").value);
var	greenStandby = Number(document.getElementById("greenStandby").value);
var	blueStandby = Number(document.getElementById("blueStandby").value);
var	whiteStandby = Number(document.getElementById("whiteStandby").value);

    $.ajax({
        url: "/setup/color",
        type: "POST",
        data: JSON.stringify({ 
			redOn: redTarget, 
			redOff: redStandby,
			greenOn: greenTarget,
			greenOff: greenStandby,
			blueOn: blueTarget,
			blueOff: blueStandby,
			whiteOn: whiteTarget,
			whiteOff: whiteStandby}),
        dataType: "json",

    });
};

setupTiming = function() {

var DurationValue = Number(document.getElementById("duration").value);
var FadeInValue = Number(document.getElementById("fadeIn").value);
var FadeOutValue = Number(document.getElementById("fadeOut").value);

    $.ajax({
        url: "/setup/timing",
        type: "POST",
        data: JSON.stringify({ 
			duration: DurationValue,
			fadein: FadeInValue,
			fadeout: FadeOutValue}),
        dataType: "json",

    });
};

setupThreshold = function() {

var thresholdValue = Number(document.getElementById("threshold").value);

    $.ajax({
        url: "/setup/threshold",
        type: "POST",
        data: JSON.stringify({ 
			threshold: thresholdValue}),
        dataType: "json",

    });
};

setupPreview = function() {

var previewEnable = document.getElementById("previewEnable").checked;
var previewTime = Number(document.getElementById("previewTime").value);
    $.ajax({
        url: "/setup/preview",
        type: "POST",
        data: JSON.stringify({ 
			enable: previewEnable,
			time: previewTime}),
        dataType: "json",

    });
};


var redTargetView = document.getElementById("redTargetView");
var redStandbyView = document.getElementById("redStandbyView");
var greenTargetView = document.getElementById("greenTargetView");
var greenStandbyView = document.getElementById("greenStandbyView");
var blueTargetView = document.getElementById("blueTargetView");
var blueStandbyView = document.getElementById("blueStandbyView");
var whiteTargetView = document.getElementById("whiteTargetView");
var whiteStandbyView = document.getElementById("whiteStandbyView");
var threshold = document.getElementById("threshold");
var prevEnable = document.getElementById("previewEnable");
var prevTime = document.getElementById("previewTime");
var duration = document.getElementById("duration");
var fadeIn = document.getElementById("fadeIn");
var fadeOut = document.getElementById("fadeOut");

var lightLevel = document.getElementById("lightLevel");


redTargetView.innerHTML = redTarget.value;
greenTargetView.innerHTML = greenTarget.value;
blueTargetView.innerHTML = blueTarget.value;
whiteTargetView.innerHTML = whiteTarget.value;
redStandbyView.innerHTML = redStandby.value;
greenStandbyView.innerHTML = greenStandby.value;
blueStandbyView.innerHTML = blueStandby.value;
whiteStandbyView.innerHTML = whiteStandby.value;




redTarget.oninput = function() {
  redTargetView.innerHTML = this.value;
}
redTarget.onchange = function() {
  setupColors();
}
redStandby.oninput = function() {
  redStandbyView.innerHTML = this.value;
}
redStandby.onchange = function() {
  setupColors();
}
greenTarget.oninput = function() {
  greenTargetView.innerHTML = this.value;
}
greenTarget.onchange = function() {
  setupColors();
}
greenStandby.oninput = function() {
  greenStandbyView.innerHTML = this.value;
}
greenStandby.onchange = function() {
  setupColors();
}
blueTarget.oninput = function() {
  blueTargetView.innerHTML = this.value;
}
blueTarget.onchange = function() {
    setupColors();
}
blueStandby.oninput = function() {
  blueStandbyView.innerHTML = this.value;
}
blueStandby.onchange = function() {
    setupColors();
}
whiteTarget.oninput = function() {
  whiteTargetView.innerHTML = this.value;
}
whiteTarget.onchange = function() {
    setupColors();
}
whiteStandby.oninput = function() {
  whiteStandbyView.innerHTML = this.value;
}
whiteStandby.onchange = function() {
    setupColors();
}

threshold.onchange = function() {
    setupThreshold();
}

duration.onchange = function() {
    setupTiming();
}

fadeIn.onchange = function() {
    setupTiming();
}

fadeOut.onchange = function() {
    setupTiming();
}

prevEnable.onchange = function() {
	setupPreview();
}
prevTime.onchange = function() {
	setupPreview();
}

</script>
</body>
</html>